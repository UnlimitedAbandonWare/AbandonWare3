spring:
  autoconfigure:
    exclude: null
  codec:
    max-in-memory-size: 16MB
abandonware:
  persona:
    tutor: You are a patient and friendly tutor. Explain concepts step by step using
      simple language and concrete examples. Encourage the user to ask follow‑up questions
      when something is unclear. Avoid overly technical jargon unless asked.
    analyzer: You are a critical analyst. Provide thorough reasoning, highlighting
      pros and cons and exploring multiple perspectives. Focus on evidence and logical
      argumentation. Maintain a neutral and factual tone.
    brainstormer: You are a creative brainstormer. Generate a variety of ideas without
      judging them. Encourage divergent thinking and explore unconventional possibilities.
      Keep responses energetic and inspiring.
  reranker:
    backend: onnx-runtime
    onnx:
      model-path: classpath:/models/your-cross-encoder.onnx
      execution-provider: cpu
      vocab-path: classpath:/models/vocab.txt
      max-seq-len: 256
      normalize: true
      fallback-enabled: false
scoring:
  path-alignment:
    enabled: true
search:
  budget:
    per-page-ms: 3500
  llm:
    backend: ${SEARCH_LLM_BACKEND:gemini}
  keyword:
    selected-terms:
      max-must: ${SEARCH_KEYWORD_SELECTED_TERMS_MAX_MUST:3}
      cache-ttl-minutes: ${SEARCH_KEYWORD_SELECTED_TERMS_CACHE_TTL_MINUTES:10}
  llm-terms:
    enable: true
    max-must: 3
    cache-ttl-minutes: 10
  brave:
    enabled: ${BRAVE_ENABLED:${brave.enabled:true}}
    api-key: ${BRAVE_API_KEY:${brave.api-key:}}
    base-url: ${BRAVE_BASE_URL:${brave.base-url:https://api.search.brave.com}}
    qps: ${BRAVE_QPS:${brave.qps:1}}
  wiki:
    enabled: true
    lang: ko
    user-agent: 'AbandonWareAI/1.0 (contact: you@example.com)'
rag:
  search:
    top-k: 10
  precision:
    max-aggregate-chars: 35000
  fuse:
    candidates: 64
  guard:
    min-evidence-count: 2
    min-evidence-from-distinct-sources: 1
  safety:
    enforceSid: true
  index:
    transient-namespace: __TRANSIENT__
  snippet:
    index-web-default: false
    ttl-days: 14
  embedding:
    dimension-guard: true
  ocr:
    enabled: true
    minConfidence: 0.65
    maxPages: 50
    chunk:
      maxChars: 1200
      overlap: 120
    rrf:
      weight: 1.2
  mp:
    enabled: true
    apply: true
  overdrive:
    enabled: true
    trigger:
      min-pool: 4
      min-authority: 0.55
      contradiction-th: 0.6
      score-th: 0.55
    k-schedule: 48,32,16,8
    relatedness:
      start: 0.2
      step: 0.1
    max-stages: 4
router:
  allow-header-override: false
  moe:
    high: gpt-5-chat-latest
    mini: gpt-5-mini
    tokens-threshold: 280
    complexity-threshold: 0.55
    uncertainty-threshold: 0.35
    web-evidence-threshold: 0.55
    escalate-on-rigid-temp: true
  threshold: 0.62
  margin: 0.08
  learning-intents: PAIRING,REASONING
naver:
  hedge:
    enabled: true
  filters:
    enable-domain-filter: true
  fallback:
    duckduckgo:
      enabled: ${NAV_FALLBACK_DDG:false}
    enable-keyword-filter: true
    keyword-min-hits: 2
    domain-allowlist:
    - go.kr
    - ac.kr
    - lenovo.com
    - news.naver.com
    - hoyoverse.com
    - hoyolab.com
  search:
    blocked-domains:
    - ohmygod10.com
    - messenger1004.com
    - blog.messenger1004.com
    - muscle1004.com
    - hermes10901.com
    query-suffix: ''
ranking:
  rrf:
    k: 60
    weights:
      web: 1.0
      semantic: 0.84
      kg: 0.7056
  rerank:
    ce:
      topK: 10
authority:
  tier-weights:
    official: 1.0
    guide: 0.85
    wiki: 0.8
    news: 0.7
    community: 0.55
rerank:
  gate:
    uncertainty-threshold: 0.45
    disagreement-threshold: 0.25
    margin-threshold: 0.08
  ambiguity:
    tau: 0.15
    mixed-cluster-threshold: 0.35
  rrf:
    k: 60
    weight:
      locale: 0.4
      language: 0.25
      authority: 0.2
      recency: 0.15
    weights:
      web: 1.0
      semantic: 0.84
      kg: 0.7056
ce:
  enabled: true
  ambiguity-threshold: 0.35
prompt:
  ambiguous-first-ask: true
  inject-source-tags: true
feature-flags:
  cluster-majority-gate: true
  source-agreement:
    topN: 7
    minAgree: 5
  terminal-intents:
  - LOCATION
  - AUTH
  - HEALTHCHECK
chat:
  defaults:
    useRag: false
  resume:
    replay-capacity: 512
    ttl-seconds: 300
location:
  enabled: true
kakao:
  rest-key: ${KAKAO_REST_KEY:}
google:
  api-key: ${GOOGLE_API_KEY:}
tmap:
  app-key: ${TMAP_APP_KEY:}
query-hygiene:
  typo-map:
    종운: 중운
  synonym-map:
    중운:
    - Chongyun
    달리아:
    - Dahlia
management:
  endpoints:
    web:
      exposure:
        include:
        - health
        - info
        - prometheus
        - metrics
        - env
        - logfile
  endpoint:
    health:
      show-details: always
  metrics:
    tags:
      application: ai-core-src-x-1core
local-llm:
  enabled: false
  provider: ollama
  base-url: http://localhost:11434/v1
  model: llama3:8b-instruct-q4_K_M
  api-key: ollama
gemini:
  api:
    key: ${GEMINI_API_KEY:}
tavily:
  api:
    key: ${TAVILY_API_KEY:}
openai:
  image:
    api-key: ${openai.api.key}
    endpoint: https://api.openai.com/v1/images/generations
    model: gpt-image-1
    timeout: PT60S
    size: 1024x1024
  api:
    url: https://api.openai.com/v1
  chat:
    model: gpt-5-mini
    model-high-tier: gpt-5-chat-latest
    force-high-tier: true
  stt:
    model: whisper-1
  tts:
    model: gpt-4o-mini-tts
    voice: alloy
guard:
  evidence_regen:
    enabled: true
    min_web_docs: 1
    min_total_docs: 2
    action: REGENERATE_AND_ESCALATE
logging:
  level:
    com.example.lms.plugin.image: INFO
domain:
  allowlist:
    default-profile: official
    external-dir: ''
probe:
  search:
    enabled: false
  admin-token: ''
  max-noise-ratio: 0.15
retriever:
  budget-ms:
    total: 6000
    self-ask: 500
    analyze: 500
    web: 3000
    vector: 2000
brave:
  api:
    key: ${BRAVE_API_KEY:}
  timeoutMs: 2500
groq:
  api:
    key: ${GROQ_API_KEY:}
  base-url: https://api.groq.com/openai/v1
  mini-model: llama-3.1-8b-instant
  big-model: llama-3.1-70b-versatile
upstash:
  redis:
    enabled: true
    rest-url: ${UPSTASH_REDIS_REST_URL:}
    rest-token: ${UPSTASH_REDIS_REST_TOKEN:}
  cache:
    ttl-seconds: 600
  ratelimit:
    per-minute: 30
retrieval:
  fusion:
    mode: weighted-rrf
    softmax:
      temperature: 1.0
      calibration: minmax
    rrf:
      k: 60
      weights:
        w_web: 1.0
        w_sem: 0.84
        w_kg: 0.7056
  vector:
    enabled: true
  kg:
    half-life-days: 60
    score:
      weights: 0.25,0.45,0.20,0.10
vector:
  upstash:
    enabled: true
    url: ${UPSTASH_VECTOR_URL:}
    token: ${UPSTASH_VECTOR_TOKEN:}
    index: ${UPSTASH_VECTOR_INDEX:rag}
    connect-timeout-ms: 1500
    read-timeout-ms: 2500
  routing:
    topics:
      genshin:
        upstash: 0.7
        primary: 0.3
      default:
        upstash: 0.5
        primary: 0.5
    min-per-store: 1
integrations:
  n8n:
    enabled: ${N8N_ENABLED:true}
    notify-url: ${N8N_NOTIFY_URL:}
    webhook-secret: ${N8N_WEBHOOK_SECRET:}
agent:
  models:
    path: ${AGENT_MODELS_PATH:classpath:configs/models.manifest.yaml}
  prcyk:
    enabled: true
    weights:
      P: 0.2
      R: 0.25
      C: 0.25
      Y: 0.2
      K: 0.1
    thresholds:
      degrade: 0.55
      fallback: 0.35
    penalties:
      rdi: 0.15
feature:
  flowjoiner:
    enabled: true
  ocr:
    enabled: false
rate:
  limit:
    provider: upstash
otel:
  exporter:
    otlp:
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4317}
pki:
  validation:
    upload-dir: ./.well-known/pki-validation
---
spring:
  servlet:
    multipart:
      max-file-size: 2MB
      max-request-size: 2MB
query.complexity.enabled: true
strategy.moe.enabled: true
selfask.branch3.enabled: true
score.calibration.isotonic: true
fusion.wpm.enabled: true
fusion.delta.projection: recentness,novelty
budget.global.ms: 2500
reranker.ce.maxConcurrency: 2
cache.singleflight.enabled: true
final.gate.pass9x.threshold: 0.9
risk.rdi.enabled: true
retrieval.topK.base: 24
retrieval.topK.min: 6
retrieval.topK.shrinkOnRisk: true
prompt.standard.enabled: true
cache:
  singleflight:
    enabled: true
    timeout-ms: 15000
    key-strategy: METHOD_AND_ARGS
    maxWaitMs: 800
autorun:
  preflight:
    enabled: false
    min-evidence: 4
    min-authority-ratio: 0.6
    rdi-threshold: -1
    action-on-fail: degrade-then-noautorun
retrieval:
  kalloc:
    enabled: true
    policy: balanced
    max-total-k: 24
    min-per-source: 2
    k-step: 4
    recency-keywords:
    - 최근
    - 오늘
    - 업데이트
    - 발표
    - 발매
    - release
  routing:
    mode: auto
    thresholds:
      complexMinTokens: 18
      topKSimple: 8
      topKComplex: 24
      topKWebRequired: 32
      rerankMinCandidates: 12
      budgetSimple: 0.25
      budgetComplex: 0.45
      budgetWeb: 0.55
    recencyKeywords:
    - 최근
    - 최신
    - 오늘
    - 올해
    - 방금
    - 업데이트
pass9x:
  weights:
    evidence: 0.35
    authority: 0.35
    contradiction: 0.2
    reproducibility: 0.1
  sigmoid:
    k: 9.0
    x0: 0.55
  threshold: 0.9
  minEvidence: 2
onnx:
  rerank:
    maxConcurrent: 4
    acquireTimeoutMs: 120
    minBudgetMs: 350
    minCandidatesForCross: 10
risk:
  alpha: 0.5
  redFlags:
  - 루머
  - 확인되지
  - 썰
  - 추정
  - 카더라
  stalePenalty: 0.25
  lowAuthorityPenalty: 0.25

# --- RuleBreak config added ---
nova:
  rulebreak:
    enabled: true
    admin-token: ${RB_ADMIN_TOKEN:}
    ttl-seconds: 60
    sse-channel: "/events/rulebreak"
    web-top-k-max: 8
    naver:
      allow-hedge-disable: true
    fusion:
      rrf-boost:
        web: 1.2
        vector: 1.0
        kg: 0.8
    whitelist:
      bypass-allowed: false


# === merge17 feature flags (default OFF) ===
features:
  planner.enabled: false
  selfask.enabled: false
  calibration.isotonic.enabled: false
  retrieval.dynamicK.enabled: false
  fusion.recencyWeight.enabled: false
  reranker.guard.enabled: false
  cache.singleflight.enabled: false
  rulebreak.enabled: false
  pii.sanitizer.enabled: false
  timebudget.enabled: false
  mcp.enabled: false

planner:
  plan: safe_autorun  # safe_autorun | brave
---

retrieval:
  k:
    web.default: 8
    vector.default: 8
    kg.default: 4
  dynamicK:
    maxWeb: 20
    maxVector: 20
    maxKg: 8

fusion:
  recencyWeight:
    halfLifeDays: 7  # 최근일수 가중

reranker:
  onnx:
    maxConcurrent: 4
    timeoutMs: 1200

rulebreak:
  header: X-RuleBreak-Token
  token: "${RULEBREAK_TOKEN:}"
  policies:
    allowDomainBypass: true
    webTopKMultiplier: 2.0

timebudget:
  defaultMs: 3000

mcp:
  serverUrl: "http://localhost:5173"
  manifestPath: "app/resources/mcp/mcp.json"

# --- merge13x added keys ---
zsys:
  timeBudget:
    ms: 0       # 0=off
  reranker:
    maxConcurrent: 3
    tryAcquire:
      ms: 50

cache:
  singleflight:
    enabled: false
    window:
      ms: 200

---
selfask:
  enabled: true
  biTopN: 80
  crossTopN: 24
  temperature: 0.4

retriever:
  safe:
    staleOnError: true
    staleMaxAgeSeconds: 86400

gate:
  preflight:
    enabled: true
    minCitations: 2
    enforceWhitelist: true

singleflight:
  enabled: true
  maxWaitMs: 1800

metrics:
  ndcg:
    enabled: true

virtualPoint:
  enabled: true

retrieval:
  k:
    dynamic:
      enabled: true


# --- PATCH: Quick Wins defaults ---
onnx:
  enabled: true
  reranker:
    max-concurrency: 4
    timeout-ms: 1800

retrieval:
  vector:
    enabled: true
  kalloc:
    web-weight: 0.7
    rag-weight: 0.3

upstash:
  cache:
    ttl-seconds: 600

naver:
  hedge:
    enabled: true
    delay-ms: 120
  search:
    timeout-ms: 1800
    web-top-k: 10

gate:
  citation:
    min-official-sources: 2
    min-snippet-chars: 400

ocr:
  confidence:
    threshold: 0.65
